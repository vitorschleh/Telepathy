<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telepathy</title> <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline'; 
                   style-src 'self' 'unsafe-inline'; 
                   connect-src 'self' https://api.telegram.org; 
                   img-src 'self' data:; 
                   object-src 'none'; 
                   base-uri 'self';">

    <style>
        /* Reset total para remover qualquer margem branca */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: #000; 
            overflow: hidden; 
            height: 100vh; 
            width: 100vw;
            font-family: 'Courier New', monospace; 
        }
        
        /* Tela de Menu (Falsa) */
        #menu-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #0a0a0a;
            color: #333;
        }
        
        #btn-performance {
            border: 1px solid #333;
            color: #444;
            background: transparent;
            padding: 20px 50px;
            font-size: 14px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        #btn-performance:active {
            background-color: #111;
            color: #666;
        }

        /* Camada Invis√≠vel de Toque (A M√°gica) */
        #stealth-layer {
            display: none; /* Come√ßa escondida */
            position: fixed;
            top: 0; left: 0; 
            width: 100%; height: 100%;
            background: black;
            z-index: 9999;
            cursor: none; /* Esconde o cursor */
        }
    </style>

    <script>
        if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
            location.replace(`https:${location.href.substring(location.protocol.length)}`);
        }
    </script>
</head>
<body>

    <div id="menu-screen">
        <button id="btn-performance" onclick="ativarModoStealth()">Performance Mode</button>
        <div style="margin-top: 20px; font-size: 10px; color: #222;">v3.0.1 Stable</div>
    </div>

    <div id="stealth-layer"></div>

    <script>
        // ==========================================
        // ‚öôÔ∏è CONFIGURA√á√ÉO DA API TELEGRAM
        // ==========================================
        const BOT_TOKEN = "SEU_TOKEN_AQUI"; // << COLAR TOKEN AQUI
        const CHAT_ID = "SEU_CHAT_ID_AQUI"; // << COLAR ID AQUI
        // ==========================================

        let contagemToques = 0;
        let fase = "VALOR"; // Pode ser: VALOR ou NAIPE
        let valorDetectado = "";
        let naipeDetectado = "";

        // Controle de Gesto
        let touchStartX = 0;
        let touchStartY = 0;
        const layer = document.getElementById('stealth-layer');

        function ativarModoStealth() {
            // Desbloqueia motor de vibra√ß√£o
            if (navigator.vibrate) navigator.vibrate(10); 

            document.getElementById('menu-screen').style.display = 'none';
            layer.style.display = 'block';
            
            // Tenta Fullscreen
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(err => console.log(err));
            }
        }

        // --- CAPTURA DE TOQUES ---
        layer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: false});

        layer.addEventListener('touchend', (e) => {
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            
            processarGesto(touchStartX, touchStartY, touchEndX, touchEndY);
        }, {passive: false});

        function processarGesto(startX, startY, endX, endY) {
            let diffX = endX - startX;
            let diffY = endY - startY;

            // 1. CLIQUE (TOQUE R√ÅPIDO - MENOS DE 20px)
            if (Math.abs(diffX) < 20 && Math.abs(diffY) < 20) {
                if (fase === "VALOR") {
                    contarToque();
                } else if (fase === "NAIPE") {
                    definirNaipe(endX, endY);
                }
            } 
            // 2. SWIPE DIREITA (ARRASTAR - MAIS DE 80px)
            else if (diffX > 80 && Math.abs(diffY) < 60) { 
                if (fase === "VALOR" && contagemToques > 0) {
                    confirmarValor(); 
                }
            }
        }

        // --- FASE 1: N√öMEROS ---
        function contarToque() {
            contagemToques++;
            // üì≥ VIBRA√á√ÉO: SIM (50ms)
            if (navigator.vibrate) navigator.vibrate(50);
            console.log("Toque: " + contagemToques);
        }

        function confirmarValor() {
            const mapa = { 1: "√Ås", 11: "Valete", 12: "Dama", 13: "Rei" };
            valorDetectado = mapa[contagemToques] || contagemToques;
            
            fase = "NAIPE"; 
            // üì≥ VIBRA√á√ÉO: N√ÉO (Swipe Silencioso conforme pedido)
            console.log("Valor Confirmado: " + valorDetectado);
        }

        // --- FASE 2: NAIPES ---
        function definirNaipe(x, y) {
            let w = window.innerWidth;
            let h = window.innerHeight;

            // Quadrantes
            if (y < h / 2) {
                if (x < w / 2) naipeDetectado = "Espadas"; // Cima Esq
                else naipeDetectado = "Copas";             // Cima Dir
            } else {
                if (x < w / 2) naipeDetectado = "Paus";    // Baixo Esq
                else naipeDetectado = "Ouros";             // Baixo Dir
            }

            // üì≥ VIBRA√á√ÉO: SIM (50ms)
            if (navigator.vibrate) navigator.vibrate(50);

            enviarParaAPI();
        }

        // --- ENVIO SEGURO ---
        function enviarParaAPI() {
            const textoFinal = `${valorDetectado} de ${naipeDetectado}`;
            const urlAPI = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(textoFinal)}`;

            fetch(urlAPI)
            .then(res => {
                if(res.ok) {
                    console.log("Sucesso: " + textoFinal);
                    // Vibra√ß√£o final longa de sucesso (Opcional)
                    if (navigator.vibrate) navigator.vibrate(200); 
                    resetarSistema();
                }
            })
            .catch(err => console.error("Erro:", err));
        }

        function resetarSistema() {
            contagemToques = 0;
            fase = "VALOR";
            valorDetectado = "";
            naipeDetectado = "";
        }

        // --- üöÄ ATIVA√á√ÉO DO PWA (SERVICE WORKER) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('PWA Service Worker Registrado'))
                    .catch(err => console.log('Erro PWA:', err));
            });
        }
    </script>
</body>
</html>
